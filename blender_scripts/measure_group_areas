import bpy
import bmesh
import json
import os

obj = bpy.data.objects['Femur-model-frame']  ## same object name
mesh = obj.data

print(obj.name, len(mesh.vertices))

# Ensure object mode
bpy.ops.object.mode_set(mode='OBJECT')

# Build bmesh
bm = bmesh.new()
bm.from_mesh(mesh)
bm.faces.ensure_lookup_table()
bm.verts.ensure_lookup_table()

# Vertex â†’ group lookup
vert_groups = {v.index: set() for v in mesh.vertices}
for v in mesh.vertices:
    for g in v.groups:
        vert_groups[v.index].add(g.group)

areas = {}

for vg in obj.vertex_groups:
    vg_area = 0.0

    for face in bm.faces:
        face_vert_indices = [v.index for v in face.verts]

        # STRICT: all verts must belong to this group
        if all(vg.index in vert_groups[i] for i in face_vert_indices):
            vg_area += face.calc_area()

    areas[vg.name] = vg_area

bm.free()

# Save JSON (same pattern as your S6 export)
out_path = os.path.join(
    bpy.path.abspath("//"),
    obj.name + "-S3-areas.json"
)

with open(out_path, "w") as f:
    json.dump(areas, f, indent=2)

print("Exported area file:", out_path)
